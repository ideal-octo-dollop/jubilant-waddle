{% extends 'base.html' %}

{% block title %}Home | Bing Chilling{% endblock %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-messages">
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<link rel="stylesheet" href="{{ url_for('static', filename='game_style.css') }}">
<main class="container">
  <a href="{{ url_for('game') }}" class="back-link">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>
    Back to Categories
  </a>

  <div class="category-header">
    <div id="category-icon" class="category-icon"></div>
    <div>
      <h1 id="category-title"></h1>
      <p id="category-description"></p>
    </div>
  </div>

  <div id="levels-container" class="cards"></div>
</main>

<div id="toast" class="toast"></div>
<footer data-aos="fade-up">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <div class="logo"><span>Bing Chilling</span></div>
        <p>Empowering students to enhance their technical skills, communication abilities, and mindset through personalized learning.</p>
      </div>
      <div class="footer-section">
        <h4>Platform</h4>
        <ul>
          <li><a href="dashboard.html">Dashboard</a></li>
          <li><a href="learning.html">Learning</a></li>
          <li><a href="challenges.html">Challenges</a></li>
          <li><a href="leaderboard.html">Leaderboard</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Company</h4>
        <ul>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Careers</a></li>
          <li><a href="#">Blog</a></li>
        </ul>
      </div>
      <div class="footer-section">
        <h4>Legal</h4>
        <ul>
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Cookie Policy</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; <span id="current-year"></span> Bing Chillling...!! All rights reserved.</p>
    </div>
  </div>
</footer>

<script>
// Category data
const categoryData = {
  aptitude: {
    title: "Aptitude Skills",
    description: "Develop logical reasoning, problem-solving, and mathematical skills through engaging challenges.",
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 6H9a2 2 0 0 0-2 2v9"></path><path d="M9 9h9a2 2 0 0 1 2 2v9"></path><path d="m3 17 3 3 3-3"></path><path d="M21 8a9 9 0 0 0-9-9 9 9 0 0 0-6.3 15.4"></path></svg>',
    color: 'text-game-blue',
    bgColor: 'bg-game-blue/10',
    levels: [
      { title: "Logic Puzzles", description: "Solve basic logic puzzles to train your analytical thinking." },
      { title: "Pattern Recognition", description: "Identify and complete complex patterns to enhance your abstract thinking." },
      { title: "Mathematical Problems", description: "Advanced mathematical challenges to boost your quantitative skills." }
    ]
  },
  communication: {
    title: "Communication Skills",
    description: "Improve your writing, speaking, and interpersonal communication through practical exercises.",
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg>',
    color: 'text-game-green',
    bgColor: 'bg-game-green/10',
    levels: [
      { title: "Email Composition", description: "Learn to write clear and effective professional emails." },
      { title: "Public Speaking", description: "Practice delivering impactful presentations and speeches." },
      { title: "Active Listening", description: "Develop better conversation skills through listening exercises." }
    ]
  },
  coding: {
    title: "Coding Skills",
    description: "Build your programming skills from basics to advanced concepts through hands-on challenges.",
    icon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m18 16 4-4-4-4"></path><path d="m6 8-4 4 4 4"></path><path d="m14.5 4-5 16"></path></svg>',
    color: 'text-game-purple',
    bgColor: 'bg-game-purple/10',
    levels: [
      { title: "HTML & CSS Basics", description: "Create your first web page using HTML and CSS." },
      { title: "JavaScript Fundamentals", description: "Learn the basics of JavaScript programming." },
      { title: "Python Algorithms", description: "Solve algorithmic challenges using Python." }
    ]
  }
};

// Game state
let gameState = {
  aptitude: {
    levels: [
      { level: 1, completed: false, locked: false },
      { level: 2, completed: false, locked: true },
      { level: 3, completed: false, locked: true }
    ]
  },
  communication: {
    levels: [
      { level: 1, completed: false, locked: false },
      { level: 2, completed: false, locked: true },
      { level: 3, completed: false, locked: true }
    ]
  },
  coding: {
    levels: [
      { level: 1, completed: false, locked: false },
      { level: 2, completed: false, locked: true },
      { level: 3, completed: false, locked: true }
    ]
  }
};

function loadGameState() {
  const savedState = localStorage.getItem('gameState');
  if (savedState) {
    try {
      gameState = JSON.parse(savedState);
    } catch (error) {
      console.error('Failed to parse saved game state:', error);
    }
  }
}

function getCurrentCategory() {
  const urlParams = new URLSearchParams(window.location.search);
  const category = urlParams.get('category');
  if (category && categoryData[category]) {
    return category;
  }
  return null;
}

function renderCategoryPage(category) {
  document.title = `${categoryData[category].title} - Quest for Skills Arena`;

  const categoryTitle = document.getElementById('category-title');
  const categoryDescription = document.getElementById('category-description');
  const categoryIcon = document.getElementById('category-icon');

  categoryTitle.textContent = categoryData[category].title;
  categoryDescription.textContent = categoryData[category].description;
  categoryIcon.className = `category-icon ${categoryData[category].bgColor}`;
  categoryIcon.innerHTML = categoryData[category].icon;

  const iconSVG = categoryIcon.querySelector('svg');
  if (iconSVG) {
    iconSVG.classList.add(categoryData[category].color);
  }

  const levelsContainer = document.getElementById('levels-container');
  levelsContainer.innerHTML = '';

  gameState[category].levels.forEach((levelState, index) => {
    const levelData = categoryData[category].levels[index];
    const levelCard = document.createElement('div');
    levelCard.className = `card ${levelState.locked ? 'level-locked' : ''} ${levelState.completed ? 'level-completed' : ''}`;

    if (levelState.completed) {
      const badge = document.createElement('div');
      badge.className = 'completion-badge';
      badge.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
      levelCard.appendChild(badge);
    }

    const title = document.createElement('h3');
    title.textContent = `Level ${levelState.level}: ${levelData.title}`;
    const desc = document.createElement('p');
    desc.textContent = levelData.description;
    const btn = document.createElement('a');
    btn.className = 'card-button';
    btn.href = `/level/${category}/${levelState.level}`;
    btn.textContent = levelState.completed ? 'Replay Level' : 'Start Level';

    levelCard.appendChild(title);
    levelCard.appendChild(desc);
    levelCard.appendChild(btn);
    levelsContainer.appendChild(levelCard);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  loadGameState();
  const category = getCurrentCategory();
  if (!category) {
    window.location.href = 'game.html';
    return;
  }
  renderCategoryPage(category);
});
</script>
{% endblock %}
